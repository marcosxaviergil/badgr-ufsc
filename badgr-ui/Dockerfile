# ğŸ”§ Stage 1: Build da aplicaÃ§Ã£o Angular
FROM node:11 AS builder

# DiretÃ³rio de trabalho dentro do container
WORKDIR /app

# Copia os arquivos do projeto Angular
COPY badgr-ui/ .

# Instala dependÃªncias
RUN npm install

# Compila a aplicaÃ§Ã£o Angular (modo produÃ§Ã£o)
RUN npm run ng build --prod


# ğŸš€ Stage 2: Servir via NGINX com ferramentas Ãºteis
FROM nginx:alpine AS runtime

# ğŸ› ï¸ Instala ferramentas de debug Ãºteis
RUN apk add --no-cache \
    nano \
    curl \
    bash \
    findutils \
    grep \
    coreutils \
    procps \
    less \
    tree \
    wget \
    net-tools

# ğŸ” Copia a configuraÃ§Ã£o personalizada do NGINX
COPY badgr-ui/nginx.conf /etc/nginx/nginx.conf

# ğŸ“¦ Copia os arquivos compilados do Angular para o NGINX servir
COPY --from=builder /app/dist /usr/share/nginx/html

# ğŸ“ Cria diretÃ³rio para scripts ou inspeÃ§Ãµes futuras
RUN mkdir -p /scripts

# ğŸš Define bash como shell padrÃ£o
SHELL ["/bin/bash", "-c"]

# ğŸŒ ExpÃµe a porta padrÃ£o do NGINX
EXPOSE 80
