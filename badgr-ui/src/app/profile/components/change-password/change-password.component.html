<main>
	<form-message></form-message>

	<header class="topbar">
		<div class="l-containerxaxis">
			<div class="topbar-x-breadcrumbs">
				<bg-breadcrumbs [linkentries]="crumbs">
				</bg-breadcrumbs>
			</div>
		</div>
		<div class="l-containerxaxis">
			<h3 class="topbar-x-heading">Alterar Senha</h3>
			<p class="topbar-x-subheading">Digite uma nova senha.</p>
		</div>
	</header>
	<div class="l-containerxaxis u-margin-top3x u-width-formsmall">
		<form class="l-form"
		      [formGroup]="changePasswordForm.rawControl"
		      (ngSubmit)="submitChange()"
		      novalidate
		>
			<fieldset>
				<bg-formfield-text [control]="changePasswordForm.rawControlMap.current_password"
				                   label="Senha Atual"
				                   errorMessage="Por favor, digite sua senha atual"
													 [errorOverride]="!!errors['current_password']"
				                   fieldType="password"
				                   [autofocus]="true"
				></bg-formfield-text>
				<p class="u-text-small u-text-error" *ngIf="errors['current_password']">{{ errors['current_password'] }}</p>

				<div class="u-margin-top2x">
					<bg-formfield-text [control]="changePasswordForm.rawControlMap.password"
					                   label="Nova Senha"
					                   [errorMessage]="{
					                       required: 'Por favor, digite sua nova senha',
					                       minlength: 'Deve ter pelo menos 8 caracteres'
					                   }"
														 [errorOverride]="!!errors['password']"
					                   fieldType="password"
					                   sublabel="Deve ter pelo menos 8 caracteres"
					></bg-formfield-text>
					<p class="u-text-small u-text-error" *ngIf="errors['password']">{{ errors['password'] }}</p>
				</div>

				<div class="u-margin-top2x">
					<bg-formfield-text [control]="changePasswordForm.rawControlMap.password2"
					                   label="Confirmar Nova Senha"
					                   fieldType="password"
					                   [errorMessage]="{
					                       required: 'Por favor, confirme sua nova senha',
					                       passwordsMatch: 'As senhas não coincidem'
					                   }"
					>
					</bg-formfield-text>
				</div>
			</fieldset>

			<div class="l-stack l-stack-buttons u-margin-top2x">
				<button class="button"
				        type="submit"
				        [loading-when-requesting]="true"
				        loading-message="Alterando Senha"
				>Alterar Senha
				</button>
				<a class="button button-secondary"
				   (click)="cancel()"
				   [disabled-when-requesting]="true"
				   tabindex="0"
				>Cancelar</a>
			</div>
			<p class="u-text u-margin-top2x u-margin-bottom3x u-margin-yaxis3x">
				Não tem sua senha atual?
				<br>
				<a (click)="forgotPassword()"
				   class="u-text-link"
				>Clique aqui</a>
				para redefinir por e-mail.
			</p>
		</form>
	</div>
</main>
